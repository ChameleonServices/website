<link rel="import" href="./bower_components/iron-ajax/iron-ajax.html">
<!-- <link rel="import" href="./cs-banner-navigation.html"> -->

<dom-module id="cs-banner">
    <template>
        <style>
            :host {
                display: block;
                min-height: 100px;
                width: inherit;
                background-color: antiquewhite;
                position: relative;
                box-shadow: 0px 4px 5px 0 #333;
            }

            #banner-logo {
                display: block;
                position: absolute;
                top: 4em;
                left: 1em;
                background-color: rgba(250, 250, 250, 0.85);
                border-radius: 8px;
                z-index: 25;
            }

            #banner-background {
                display: block;
                position: absolute;
                box-sizing: border-box;
                width: 100%;
                height: 100%;
                z-index: 5;
                padding-top: 3em;

                background: antiquewhite no-repeat center center fixed;
                background-image: none;
                background-size: cover;
                transition: 3s;
            }

            #banner-overlay {
                position: relative;
                width: 100%;
                height: 100%;
                z-index: 10;
                --overlay-background: rgba(0, 0, 0, 0.25);
            }
        </style>

        <iron-ajax auto
            url="[[imageListPath]]"
            handle-as="json"
            on-response="parseBannerImages"
            debounce-duration="300"></iron-ajax>

         <div id="banner-background"></div> 

        <div id="banner-overlay">
            <div id="banner-logo">
                <img src="/media/logo-lg.png" alt="Chameleon Services logo" width="360" />
            </div>

            <!-- <cs-banner-navigation></cs-banner-navigation> -->
        </div>
    </template>

    <script>
        class ChameleonBanner extends Polymer.Element {
            static get is() { return 'cs-banner'; }

            static get properties() {
                return {
                    imageListPath: {
                        type: String,
                        value: "banner.json"
                    },

                    basePath: {
                        type: String,
                        value: "./media/"
                    },

                    transitionTime: {
                        type: Number,
                        value: 10
                    },

                    currentImage: {
                        type: Number,
                        value: 0
                    }
                }
            }

            parseBannerImages(data) {
                this.images = [];

                let bannerImages = data.detail.response;
                if(!bannerImages) return;

                bannerImages.forEach(path => {
                    this.images.push(new Image().src = this.basePath + path);
                });

                this.maxImage = bannerImages.length - 1;
                console.log("Got image list: ", this.images);

                let banner = this.shadowRoot.querySelector("#banner-background");
                banner.style.backgroundImage = "url('" + this.images[0] + "')";

                setInterval(this.changeImage.bind(this), this.transitionTime * 1000);
            }
            
            changeImage() {
                this.currentImage++;
                if(this.currentImage > this.maxImage) 
                    this.currentImage = 0;

                let banner = this.shadowRoot.querySelector("#banner-background");
                banner.style.backgroundImage = "url('" + this.images[this.currentImage] + "')";
            }
        }

        customElements.define(ChameleonBanner.is, ChameleonBanner);
    </script>
</dom-module>